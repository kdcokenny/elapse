{
	"date": "2024-10-15",
	"commits": [
		{
			"sha": "6c4bbc783286bf6eebd9927cb52e8fec5ad4dd74",
			"message": "[Re-land] Make prerendering always non-blocking (#31268)\n\nFollows https://github.com/facebook/react/pull/31238\r\n\r\n___\r\n\r\nThis is a partial re-land of\r\nhttps://github.com/facebook/react/pull/31056. We saw breakages surface\r\nafter the original land and had to revert. Now that they've been fixed,\r\nlet's try this again. This time we'll split up the commits to give us\r\nmore control of testing and rollout internally.\r\n\r\nOriginal PR: https://github.com/facebook/react/pull/31056\r\nOriginal Commit:\r\nhttps://github.com/facebook/react/pull/31056/commits/4c71025d8d1bd46344ad793e7ed3049d24f7395a\r\nRevert PR: https://github.com/facebook/react/pull/31080\r\n\r\nCommit description:\r\n\r\n> When a synchronous update suspends, and we prerender the siblings, the\r\nprerendering should be non-blocking so that we can immediately restart\r\nonce the data arrives.\r\n>\r\n> This happens automatically when there's a Suspense boundary, because\r\nwe immediately commit the boundary and then proceed to a Retry render,\r\nwhich are always concurrent. When there's not a Suspense boundary, there\r\nis no Retry, so we need to take care to switch from the synchronous work\r\nloop to the concurrent one, to enable time slicing.\r\n\r\nCo-authored-by: Andrew Clark <git@andrewclark.io>",
			"user": "jackpope",
			"timestamp": "2024-10-15T20:47:02Z",
			"author": {
				"name": "Jack Pope",
				"email": "jackpope1@gmail.com",
				"username": "jackpope"
			},
			"files": {
				"added": [],
				"modified": [
					"packages/react-dom/src/__tests__/ReactDOMFiberAsync-test.js",
					"packages/react-reconciler/src/ReactFiberLane.js",
					"packages/react-reconciler/src/ReactFiberRootScheduler.js",
					"packages/react-reconciler/src/ReactFiberWorkLoop.js",
					"packages/react-reconciler/src/__tests__/ReactDeferredValue-test.js",
					"packages/react-reconciler/src/__tests__/ReactSiblingPrerendering-test.js"
				],
				"removed": []
			},
			"diff": "diff --git a/packages/react-dom/src/__tests__/ReactDOMFiberAsync-test.js b/packages/react-dom/src/__tests__/ReactDOMFiberAsync-test.js\nindex ee843996bef..027099d5470 100644\n--- a/packages/react-dom/src/__tests__/ReactDOMFiberAsync-test.js\n+++ b/packages/react-dom/src/__tests__/ReactDOMFiberAsync-test.js\n@@ -744,7 +744,7 @@ describe('ReactDOMFiberAsync', () => {\n       // Because it suspended, it remains on the current path\n       expect(div.textContent).toBe('/path/a');\n     });\n-    assertLog([]);\n+    assertLog(gate('enableSiblingPrerendering') ? ['Suspend! [/path/b]'] : []);\n \n     await act(async () => {\n       resolvePromise();\ndiff --git a/packages/react-reconciler/src/ReactFiberLane.js b/packages/react-reconciler/src/ReactFiberLane.js\nindex 7d6bfd16e8a..b98019046e3 100644\n--- a/packages/react-reconciler/src/ReactFiberLane.js\n+++ b/packages/react-reconciler/src/ReactFiberLane.js\n@@ -765,12 +765,14 @@ export function markRootSuspended(\n   root: FiberRoot,\n   suspendedLanes: Lanes,\n   spawnedLane: Lane,\n-  didSkipSuspendedSiblings: boolean,\n+  didAttemptEntireTree: boolean,\n ) {\n+  // TODO: Split this into separate functions for marking the root at the end of\n+  // a render attempt versus suspending while the root is still in progress.\n   root.suspendedLanes |= suspendedLanes;\n   root.pingedLanes &= ~suspendedLanes;\n \n-  if (enableSiblingPrerendering && !didSkipSuspendedSiblings) {\n+  if (enableSiblingPrerendering && didAttemptEntireTree) {\n     // Mark these lanes as warm so we know there's nothing else to work on.\n     root.warmLanes |= suspendedLanes;\n   } else {\ndiff --git a/packages/react-reconciler/src/ReactFiberRootScheduler.js b/packages/react-reconciler/src/ReactFiberRootScheduler.js\nindex 9f267e8345e..39f6f466ed9 100644\n--- a/packages/react-reconciler/src/ReactFiberRootScheduler.js\n+++ b/packages/react-reconciler/src/ReactFiberRootScheduler.js\n@@ -18,6 +18,7 @@ import {\n   disableSchedulerTimeoutInWorkLoop,\n   enableProfilerTimer,\n   enableProfilerNestedUpdatePhase,\n+  enableSiblingPrerendering,\n } from 'shared/ReactFeatureFlags';\n import {\n   NoLane,\n@@ -29,6 +30,7 @@ import {\n   markStarvedLanesAsExpired,\n   claimNextTransitionLane,\n   getNextLanesToFlushSync,\n+  checkIfRootIsPrerendering,\n } from './ReactFiberLane';\n import {\n   CommitContext,\n@@ -206,7 +208,10 @@ function flushSyncWorkAcrossRoots_impl(\n               ? workInProgressRootRenderLanes\n               : NoLanes,\n           );\n-          if (includesSyncLane(nextLanes)) {\n+          if (\n+            includesSyncLane(nextLanes) &&\n+            !checkIfRootIsPrerendering(root, nextLanes)\n+          ) {\n             // This root has pending sync work. Flush it now.\n             didPerformSomeWork = true;\n             performSyncWorkOnRoot(root, nextLanes);\n@@ -341,7 +346,13 @@ function scheduleTaskForRootDuringMicrotask(\n   }\n \n   // Schedule a new callback in the host environment.\n-  if (includesSyncLane(nextLanes)) {\n+  if (\n+    includesSyncLane(nextLanes) &&\n+    // If we're prerendering, then we should use the concurrent work loop\n+    // even if the lanes are synchronous, so that prerendering never blocks\n+    // the main thread.\n+    !(enableSiblingPrerendering && checkIfRootIsPrerendering(root, nextLanes))\n+  ) {\n     // Synchronous work is always flushed at the end of the microtask, so we\n     // don't need to schedule an additional task.\n     if (existingCallbackNode !== null) {\n@@ -375,9 +386,10 @@ function scheduleTaskForRootDuringMicrotask(\n \n     let schedulerPriorityLevel;\n     switch (lanesToEventPriority(nextLanes)) {\n+      // Scheduler does have an \"ImmediatePriority\", but now that we use\n+      // microtasks for sync work we no longer use that. Any sync work that\n+      // reaches this path is meant to be time sliced.\n       case DiscreteEventPriority:\n-        schedulerPriorityLevel = ImmediateSchedulerPriority;\n-        break;\n       case ContinuousEventPriority:\n         schedulerPriorityLevel = UserBlockingSchedulerPriority;\n         break;\ndiff --git a/packages/react-reconciler/src/ReactFiberWorkLoop.js b/packages/react-reconciler/src/ReactFiberWorkLoop.js\nindex 196859f6fa7..c40fc537049 100644\n--- a/packages/react-reconciler/src/ReactFiberWorkLoop.js\n+++ b/packages/react-reconciler/src/ReactFiberWorkLoop.js\n@@ -765,11 +765,12 @@ export function scheduleUpdateOnFiber(\n     // The incoming update might unblock the current render. Interrupt the\n     // current attempt and restart from the top.\n     prepareFreshStack(root, NoLanes);\n+    const didAttemptEntireTree = false;\n     markRootSuspended(\n       root,\n       workInProgressRootRenderLanes,\n       workInProgressDeferredLane,\n-      workInProgressRootDidSkipSuspendedSiblings,\n+      didAttemptEntireTree,\n     );\n   }\n \n@@ -832,11 +833,12 @@ export function scheduleUpdateOnFiber(\n         // effect of interrupting the current render and switching to the update.\n         // TODO: Make sure this doesn't override pings that happen while we've\n         // already started rendering.\n+        const didAttemptEntireTree = false;\n         markRootSuspended(\n           root,\n           workInProgressRootRenderLanes,\n           workInProgressDeferredLane,\n-          workInProgressRootDidSkipSuspendedSiblings,\n+          didAttemptEntireTree,\n         );\n       }\n     }\n@@ -898,100 +900,120 @@ export function performWorkOnRoot(\n   // for too long (\"expired\" work, to prevent starvation), or we're in\n   // sync-updates-by-default mode.\n   const shouldTimeSlice =\n-    !forceSync &&\n-    !includesBlockingLane(lanes) &&\n-    !includesExpiredLane(root, lanes);\n+    (!forceSync &&\n+      !includesBlockingLane(lanes) &&\n+      !includesExpiredLane(root, lanes)) ||\n+    // If we're prerendering, then we should use the concurrent work loop\n+    // even if the lanes are synchronous, so that prerendering never blocks\n+    // the main thread.\n+    // TODO: We should consider doing this whenever a sync lane is suspended,\n+    // even for regular pings.\n+    (enableSiblingPrerendering && checkIfRootIsPrerendering(root, lanes));\n+\n   let exitStatus = shouldTimeSlice\n     ? renderRootConcurrent(root, lanes)\n-    : renderRootSync(root, lanes);\n+    : renderRootSync(root, lanes, true);\n \n-  if (exitStatus !== RootInProgress) {\n+  do {\n     let renderWasConcurrent = shouldTimeSlice;\n-    do {\n-      if (exitStatus === RootDidNotComplete) {\n-        // The render unwound without completing the tree. This happens in special\n-        // cases where need to exit the current render without producing a\n-        // consistent tree or committing.\n-        markRootSuspended(\n+    if (exitStatus === RootInProgress) {\n+      // Render phase is still in progress.\n+      if (\n+        enableSiblingPrerendering &&\n+        workInProgressRootIsPrerendering &&\n+        !shouldTimeSlice\n+      ) {\n+        // We're in prerendering mode, but time slicing is not enabled. This\n+        // happens when something suspends during a synchronous update. Exit the\n+        // the work loop. When we resume, we'll use the concurrent work loop so\n+        // that prerendering is non-blocking.\n+        //\n+        // Mark the root as suspended. Usually we do this at the end of the\n+        // render phase, but we do it here so that we resume in\n+        // prerendering mode.\n+        // TODO: Consider always calling markRootSuspended immediately.\n+        // Needs to be *after* we attach a ping listener, though.\n+        const didAttemptEntireTree = false;\n+        markRootSuspended(root, lanes, NoLane, didAttemptEntireTree);\n+      }\n+      break;\n+    } else if (exitStatus === RootDidNotComplete) {\n+      // The render unwound without completing the tree. This happens in special\n+      // cases where need to exit the current render without producing a\n+      // consistent tree or committing.\n+      const didAttemptEntireTree = !workInProgressRootDidSkipSuspendedSiblings;\n+      markRootSuspended(root, lanes, NoLane, didAttemptEntireTree);\n+    } else {\n+      // The render completed.\n+\n+      // Check if this render may have yielded to a concurrent event, and if so,\n+      // confirm that any newly rendered stores are consistent.\n+      // TODO: It's possible that even a concurrent render may never have yielded\n+      // to the main thread, if it was fast enough, or if it expired. We could\n+      // skip the consistency check in that case, too.\n+      const finishedWork: Fiber = (root.current.alternate: any);\n+      if (\n+        renderWasConcurrent &&\n+        !isRenderConsistentWithExternalStores(finishedWork)\n+      ) {\n+        // A store was mutated in an interleaved event. Render again,\n+        // synchronously, to block further mutations.\n+        exitStatus = renderRootSync(root, lanes, false);\n+        // We assume the tree is now consistent because we didn't yield to any\n+        // concurrent events.\n+        renderWasConcurrent = false;\n+        // Need to check the exit status again.\n+        continue;\n+      }\n+\n+      // Check if something threw\n+      if (\n+        (disableLegacyMode || root.tag !== LegacyRoot) &&\n+        exitStatus === RootErrored\n+      ) {\n+        const lanesThatJustErrored = lanes;\n+        const errorRetryLanes = getLanesToRetrySynchronouslyOnError(\n           root,\n-          lanes,\n-          NoLane,\n-          workInProgressRootDidSkipSuspendedSiblings,\n+          lanesThatJustErrored,\n         );\n-      } else {\n-        // The render completed.\n-\n-        // Check if this render may have yielded to a concurrent event, and if so,\n-        // confirm that any newly rendered stores are consistent.\n-        // TODO: It's possible that even a concurrent render may never have yielded\n-        // to the main thread, if it was fast enough, or if it expired. We could\n-        // skip the consistency check in that case, too.\n-        const finishedWork: Fiber = (root.current.alternate: any);\n-        if (\n-          renderWasConcurrent &&\n-          !isRenderConsistentWithExternalStores(finishedWork)\n-        ) {\n-          // A store was mutated in an interleaved event. Render again,\n-          // synchronously, to block further mutations.\n-          exitStatus = renderRootSync(root, lanes);\n-          // We assume the tree is now consistent because we didn't yield to any\n-          // concurrent events.\n-          renderWasConcurrent = false;\n-          // Need to check the exit status again.\n-          continue;\n-        }\n-\n-        // Check if something threw\n-        if (\n-          (disableLegacyMode || root.tag !== LegacyRoot) &&\n-          exitStatus === RootErrored\n-        ) {\n-          const lanesThatJustErrored = lanes;\n-          const errorRetryLanes = getLanesToRetrySynchronouslyOnError(\n+        if (errorRetryLanes !== NoLanes) {\n+          lanes = errorRetryLanes;\n+          exitStatus = recoverFromConcurrentError(\n             root,\n             lanesThatJustErrored,\n+            errorRetryLanes,\n           );\n-          if (errorRetryLanes !== NoLanes) {\n-            lanes = errorRetryLanes;\n-            exitStatus = recoverFromConcurrentError(\n-              root,\n-              lanesThatJustErrored,\n-              errorRetryLanes,\n-            );\n-            renderWasConcurrent = false;\n-            // Need to check the exit status again.\n-            if (exitStatus !== RootErrored) {\n-              // The root did not error this time. Restart the exit algorithm\n-              // from the beginning.\n-              // TODO: Refactor the exit algorithm to be less confusing. Maybe\n-              // more branches + recursion instead of a loop. I think the only\n-              // thing that causes it to be a loop is the RootDidNotComplete\n-              // check. If that's true, then we don't need a loop/recursion\n-              // at all.\n-              continue;\n-            } else {\n-              // The root errored yet again. Proceed to commit the tree.\n-            }\n+          renderWasConcurrent = false;\n+          // Need to check the exit status again.\n+          if (exitStatus !== RootErrored) {\n+            // The root did not error this time. Restart the exit algorithm\n+            // from the beginning.\n+            // TODO: Refactor the exit algorithm to be less confusing. Maybe\n+            // more branches + recursion instead of a loop. I think the only\n+            // thing that causes it to be a loop is the RootDidNotComplete\n+            // check. If that's true, then we don't need a loop/recursion\n+            // at all.\n+            continue;\n+          } else {\n+            // The root errored yet again. Proceed to commit the tree.\n           }\n         }\n-        if (exitStatus === RootFatalErrored) {\n-          prepareFreshStack(root, NoLanes);\n-          markRootSuspended(\n-            root,\n-            lanes,\n-            NoLane,\n-            workInProgressRootDidSkipSuspendedSiblings,\n-          );\n-          break;\n-        }\n-\n-        // We now have a consistent tree. The next step is either to commit it,\n-        // or, if something suspended, wait to commit it after a timeout.\n-        finishConcurrentRender(root, exitStatus, finishedWork, lanes);\n       }\n-      break;\n-    } while (true);\n-  }\n+      if (exitStatus === RootFatalErrored) {\n+        prepareFreshStack(root, NoLanes);\n+        // Since this is a fatal error, we're going to pretend we attempted\n+        // the entire tree, to avoid scheduling a prerender.\n+        const didAttemptEntireTree = true;\n+        markRootSuspended(root, lanes, NoLane, didAttemptEntireTree);\n+        break;\n+      }\n+\n+      // We now have a consistent tree. The next step is either to commit it,\n+      // or, if something suspended, wait to commit it after a timeout.\n+      finishConcurrentRender(root, exitStatus, finishedWork, lanes);\n+    }\n+    break;\n+  } while (true);\n \n   ensureRootIsScheduled(root);\n }\n@@ -1024,7 +1046,7 @@ function recoverFromConcurrentError(\n     rootWorkInProgress.flags |= ForceClientRender;\n   }\n \n-  const exitStatus = renderRootSync(root, errorRetryLanes);\n+  const exitStatus = renderRootSync(root, errorRetryLanes, false);\n   if (exitStatus !== RootErrored) {\n     // Successfully finished rendering on retry\n \n@@ -1108,11 +1130,13 @@ function finishConcurrentRender(\n         // This is a transition, so we should exit without committing a\n         // placeholder and without scheduling a timeout. Delay indefinitely\n         // until we receive more data.\n+        const didAttemptEntireTree =\n+          !workInProgressRootDidSkipSuspendedSiblings;\n         markRootSuspended(\n           root,\n           lanes,\n           workInProgressDeferredLane,\n-          workInProgressRootDidSkipSuspendedSiblings,\n+          didAttemptEntireTree,\n         );\n         return;\n       }\n@@ -1168,11 +1192,13 @@ function finishConcurrentRender(\n \n       // Don't bother with a very short suspense time.\n       if (msUntilTimeout > 10) {\n+        const didAttemptEntireTree =\n+          !workInProgressRootDidSkipSuspendedSiblings;\n         markRootSuspended(\n           root,\n           lanes,\n           workInProgressDeferredLane,\n-          workInProgressRootDidSkipSuspendedSiblings,\n+          didAttemptEntireTree,\n         );\n \n         const nextLanes = getNextLanes(root, NoLanes);\n@@ -1286,7 +1312,8 @@ function commitRootWhenReady(\n           completedRenderEndTime,\n         ),\n       );\n-      markRootSuspended(root, lanes, spawnedLane, didSkipSuspendedSiblings);\n+      const didAttemptEntireTree = !didSkipSuspendedSiblings;\n+      markRootSuspended(root, lanes, spawnedLane, didAttemptEntireTree);\n       return;\n     }\n   }\n@@ -1409,7 +1436,7 @@ function markRootSuspended(\n   root: FiberRoot,\n   suspendedLanes: Lanes,\n   spawnedLane: Lane,\n-  didSkipSuspendedSiblings: boolean,\n+  didAttemptEntireTree: boolean,\n ) {\n   // When suspending, we should always exclude lanes that were pinged or (more\n   // rarely, since we try to avoid it) updated during the render phase.\n@@ -1418,12 +1445,7 @@ function markRootSuspended(\n     suspendedLanes,\n     workInProgressRootInterleavedUpdatedLanes,\n   );\n-  _markRootSuspended(\n-    root,\n-    suspendedLanes,\n-    spawnedLane,\n-    didSkipSuspendedSiblings,\n-  );\n+  _markRootSuspended(root, suspendedLanes, spawnedLane, didAttemptEntireTree);\n }\n \n export function flushRoot(root: FiberRoot, lanes: Lanes) {\n@@ -1965,7 +1987,12 @@ export function renderDidSuspendDelayIfPossible(): void {\n \n   if (\n     !workInProgressRootDidSkipSuspendedSiblings &&\n-    !includesBlockingLane(workInProgressRootRenderLanes)\n+    // Check if the root will be blocked from committing.\n+    // TODO: Consider aligning this better with the rest of the logic. Maybe\n+    // we should only set the exit status to RootSuspendedWithDelay if this\n+    // condition is true? And remove the equivalent checks elsewhere.\n+    (includesOnlyTransitions(workInProgressRootRenderLanes) ||\n+      getSuspenseHandler() === null)\n   ) {\n     // This render may not have originally been scheduled as a prerender, but\n     // something suspended inside the visible part of the tree, which means we\n@@ -1991,11 +2018,12 @@ export function renderDidSuspendDelayIfPossible(): void {\n     // pinged or updated while we were rendering.\n     // TODO: Consider unwinding immediately, using the\n     // SuspendedOnHydration mechanism.\n+    const didAttemptEntireTree = false;\n     markRootSuspended(\n       workInProgressRoot,\n       workInProgressRootRenderLanes,\n       workInProgressDeferredLane,\n-      workInProgressRootDidSkipSuspendedSiblings,\n+      didAttemptEntireTree,\n     );\n   }\n }\n@@ -2025,7 +2053,11 @@ export function renderHasNotSuspendedYet(): boolean {\n // TODO: Over time, this function and renderRootConcurrent have become more\n // and more similar. Not sure it makes sense to maintain forked paths. Consider\n // unifying them again.\n-function renderRootSync(root: FiberRoot, lanes: Lanes) {\n+function renderRootSync(\n+  root: FiberRoot,\n+  lanes: Lanes,\n+  shouldYieldForPrerendering: boolean,\n+): RootExitStatus {\n   const prevExecutionContext = executionContext;\n   executionContext |= RenderContext;\n   const prevDispatcher = pushDispatcher(root.containerInfo);\n@@ -2065,6 +2097,7 @@ function renderRootSync(root: FiberRoot, lanes: Lanes) {\n   }\n \n   let didSuspendInShell = false;\n+  let exitStatus = workInProgressRootExitStatus;\n   outer: do {\n     try {\n       if (\n@@ -2086,16 +2119,37 @@ function renderRootSync(root: FiberRoot, lanes: Lanes) {\n             // Selective hydration. An update flowed into a dehydrated tree.\n             // Interrupt the current render so the work loop can switch to the\n             // hydration lane.\n+            // TODO: I think we might not need to reset the stack here; we can\n+            // just yield and reset the stack when we re-enter the work loop,\n+            // like normal.\n             resetWorkInProgressStack();\n-            workInProgressRootExitStatus = RootDidNotComplete;\n+            exitStatus = RootDidNotComplete;\n             break outer;\n           }\n           case SuspendedOnImmediate:\n-          case SuspendedOnData: {\n-            if (!didSuspendInShell && getSuspenseHandler() === null) {\n+          case SuspendedOnData:\n+          case SuspendedOnDeprecatedThrowPromise: {\n+            if (getSuspenseHandler() === null) {\n               didSuspendInShell = true;\n             }\n-            // Intentional fallthrough\n+            const reason = workInProgressSuspendedReason;\n+            workInProgressSuspendedReason = NotSuspended;\n+            workInProgressThrownValue = null;\n+            throwAndUnwindWorkLoop(root, unitOfWork, thrownValue, reason);\n+            if (\n+              enableSiblingPrerendering &&\n+              shouldYieldForPrerendering &&\n+              workInProgressRootIsPrerendering\n+            ) {\n+              // We've switched into prerendering mode. This implies that we\n+              // suspended outside of a Suspense boundary, which means this\n+              // render will be blocked from committing. Yield to the main\n+              // thread so we can switch to prerendering using the concurrent\n+              // work loop.\n+              exitStatus = RootInProgress;\n+              break outer;\n+            }\n+            break;\n           }\n           default: {\n             // Unwind then continue with the normal work loop.\n@@ -2108,6 +2162,7 @@ function renderRootSync(root: FiberRoot, lanes: Lanes) {\n         }\n       }\n       workLoopSync();\n+      exitStatus = workInProgressRootExitStatus;\n       break;\n     } catch (thrownValue) {\n       handleThrow(root, thrownValue);\n@@ -2130,14 +2185,6 @@ function renderRootSync(root: FiberRoot, lanes: Lanes) {\n   popDispatcher(prevDispatcher);\n   popAsyncDispatcher(prevAsyncDispatcher);\n \n-  if (workInProgress !== null) {\n-    // This is a sync render, so we should have finished the whole tree.\n-    throw new Error(\n-      'Cannot commit an incomplete root. This error is likely caused by a ' +\n-        'bug in React. Please file an issue.',\n-    );\n-  }\n-\n   if (__DEV__) {\n     if (enableDebugTracing) {\n       logRenderStopped();\n@@ -2148,14 +2195,21 @@ function renderRootSync(root: FiberRoot, lanes: Lanes) {\n     markRenderStopped();\n   }\n \n-  // Set this to null to indicate there's no in-progress render.\n-  workInProgressRoot = null;\n-  workInProgressRootRenderLanes = NoLanes;\n+  if (workInProgress !== null) {\n+    // Did not complete the tree. This can happen if something suspended in\n+    // the shell.\n+  } else {\n+    // Normal case. We completed the whole tree.\n+\n+    // Set this to null to indicate there's no in-progress render.\n+    workInProgressRoot = null;\n+    workInProgressRootRenderLanes = NoLanes;\n \n-  // It's safe to process the queue now that the render phase is complete.\n-  finishQueueingConcurrentUpdates();\n+    // It's safe to process the queue now that the render phase is complete.\n+    finishQueueingConcurrentUpdates();\n+  }\n \n-  return workInProgressRootExitStatus;\n+  return exitStatus;\n }\n \n // The work loop is an extremely hot path. Tell Closure not to inline it.\n@@ -2201,9 +2255,7 @@ function renderRootConcurrent(root: FiberRoot, lanes: Lanes) {\n     //\n     // If we were previously in prerendering mode, check if we received any new\n     // data during an interleaved event.\n-    if (workInProgressRootIsPrerendering) {\n-      workInProgressRootIsPrerendering = checkIfRootIsPrerendering(root, lanes);\n-    }\n+    workInProgressRootIsPrerendering = checkIfRootIsPrerendering(root, lanes);\n   }\n \n   if (__DEV__) {\n@@ -3753,6 +3805,9 @@ function pingSuspendedRoot(\n     // the logic of whether or not a root suspends once it completes.\n     // TODO: If we're rendering sync either due to Sync, Batched or expired,\n     // we should probably never restart.\n+    // TODO: Attach different listeners depending on whether the listener was\n+    // attached during prerendering. Prerender pings should not interrupt\n+    // normal renders.\n \n     // If we're suspended with delay, or if it's a retry, we'll always suspend\n     // so we can always restart.\ndiff --git a/packages/react-reconciler/src/__tests__/ReactDeferredValue-test.js b/packages/react-reconciler/src/__tests__/ReactDeferredValue-test.js\nindex fd03ba7310f..8ca142cb505 100644\n--- a/packages/react-reconciler/src/__tests__/ReactDeferredValue-test.js\n+++ b/packages/react-reconciler/src/__tests__/ReactDeferredValue-test.js\n@@ -420,6 +420,10 @@ describe('ReactDeferredValue', () => {\n         // The initial value suspended, so we attempt the final value, which\n         // also suspends.\n         'Suspend! [Final]',\n+\n+        ...(gate('enableSiblingPrerendering')\n+          ? ['Suspend! [Loading...]', 'Suspend! [Final]']\n+          : []),\n       ]);\n       expect(root).toMatchRenderedOutput(null);\n \n@@ -459,6 +463,10 @@ describe('ReactDeferredValue', () => {\n         // The initial value suspended, so we attempt the final value, which\n         // also suspends.\n         'Suspend! [Final]',\n+\n+        ...(gate('enableSiblingPrerendering')\n+          ? ['Suspend! [Loading...]', 'Suspend! [Final]']\n+          : []),\n       ]);\n       expect(root).toMatchRenderedOutput(null);\n \n@@ -533,6 +541,10 @@ describe('ReactDeferredValue', () => {\n         // The initial value suspended, so we attempt the final value, which\n         // also suspends.\n         'Suspend! [Final]',\n+\n+        ...(gate('enableSiblingPrerendering')\n+          ? ['Suspend! [Loading...]', 'Suspend! [Final]']\n+          : []),\n       ]);\n       expect(root).toMatchRenderedOutput(null);\n \ndiff --git a/packages/react-reconciler/src/__tests__/ReactSiblingPrerendering-test.js b/packages/react-reconciler/src/__tests__/ReactSiblingPrerendering-test.js\nindex 37d907b0fdc..235e8df2201 100644\n--- a/packages/react-reconciler/src/__tests__/ReactSiblingPrerendering-test.js\n+++ b/packages/react-reconciler/src/__tests__/ReactSiblingPrerendering-test.js\n@@ -479,4 +479,75 @@ describe('ReactSiblingPrerendering', () => {\n       assertLog([]);\n     },\n   );\n+\n+  it(\n+    'when a synchronous update suspends outside a boundary, the resulting' +\n+      'prerender is concurrent',\n+    async () => {\n+      function App() {\n+        return (\n+          <>\n+            <Text text=\"A\" />\n+            <Text text=\"B\" />\n+            <AsyncText text=\"Async\" />\n+            <Text text=\"C\" />\n+            <Text text=\"D\" />\n+          </>\n+        );\n+      }\n+\n+      const root = ReactNoop.createRoot();\n+      // Mount the root synchronously\n+      ReactNoop.flushSync(() => root.render(<App />));\n+\n+      // Synchronously render everything until we suspend in the shell\n+      assertLog(['A', 'B', 'Suspend! [Async]']);\n+\n+      if (gate('enableSiblingPrerendering')) {\n+        // The rest of the siblings begin to prerender concurrently. Notice\n+        // that we don't unwind here; we pick up where we left off above.\n+        await waitFor(['C']);\n+        await waitFor(['D']);\n+      }\n+\n+      assertLog([]);\n+      expect(root).toMatchRenderedOutput(null);\n+\n+      await resolveText('Async');\n+      assertLog(['A', 'B', 'Async', 'C', 'D']);\n+      expect(root).toMatchRenderedOutput('ABAsyncCD');\n+    },\n+  );\n+\n+  it('restart a suspended sync render if something suspends while prerendering the siblings', async () => {\n+    function App() {\n+      return (\n+        <>\n+          <Text text=\"A\" />\n+          <Text text=\"B\" />\n+          <AsyncText text=\"Async\" />\n+          <Text text=\"C\" />\n+          <Text text=\"D\" />\n+        </>\n+      );\n+    }\n+\n+    const root = ReactNoop.createRoot();\n+    // Mount the root synchronously\n+    ReactNoop.flushSync(() => root.render(<App />));\n+\n+    // Synchronously render everything until we suspend in the shell\n+    assertLog(['A', 'B', 'Suspend! [Async]']);\n+\n+    if (gate('enableSiblingPrerendering')) {\n+      // The rest of the siblings begin to prerender concurrently\n+      await waitFor(['C']);\n+    }\n+\n+    // While we're prerendering, Async resolves. We should unwind and\n+    // start over, rather than continue prerendering D.\n+    await resolveText('Async');\n+    assertLog(['A', 'B', 'Async', 'C', 'D']);\n+    expect(root).toMatchRenderedOutput('ABAsyncCD');\n+  });\n });\n",
			"diffSize": 27268,
			"diffTruncated": false,
			"filterResult": {
				"included": true
			},
			"associatedPR": {
				"number": 31268,
				"title": "[Re-land] Make prerendering always non-blocking",
				"state": "closed",
				"draft": false,
				"merged": true,
				"branch": "reland-nonblocking-sync-prerenders-2",
				"baseBranch": "main",
				"author": "jackpope",
				"body": "Follows https://github.com/facebook/react/pull/31238\r\n\r\n___\r\n\r\nThis is a partial re-land of https://github.com/facebook/react/pull/31056. We saw breakages surface after the original land and had to revert. Now that they've been fixed, let's try this again. This time we'll split up the commits to give us more control of testing and rollout internally.\r\n\r\nOriginal PR: https://github.com/facebook/react/pull/31056\r\nOriginal Commit: https://github.com/facebook/react/pull/31056/commits/4c71025d8d1bd46344ad793e7ed3049d24f7395a\r\nRevert PR: https://github.com/facebook/react/pull/31080\r\n\r\nCommit description:\r\n\r\n> When a synchronous update suspends, and we prerender the siblings, the prerendering should be non-blocking so that we can immediately restart once the data arrives.\r\n>\r\n> This happens automatically when there's a Suspense boundary, because we immediately commit the boundary and then proceed to a Retry render, which are always concurrent. When there's not a Suspense boundary, there is no Retry, so we need to take care to switch from the synchronous work loop to the concurrent one, to enable time slicing.",
				"labels": ["CLA Signed", "React Core Team"],
				"requestedReviewers": ["acdlite"],
				"reviews": [
					{
						"id": 2370231973,
						"state": "APPROVED",
						"author": "rickhanlonii"
					}
				],
				"comments": [
					{
						"id": 2414687425,
						"body": "[vc]: #5gf6a61V9KCuirK4rONSPo8AhJUgXZGrkZ2RqKXi5zE=:eyJpc01vbm9yZXBvIjp0cnVlLCJ0eXBlIjoiZ2l0aHViIiwicHJvamVjdHMiOlt7Im5hbWUiOiJyZWFjdC1jb21waWxlci1wbGF5Z3JvdW5kIiwicm9vdERpcmVjdG9yeSI6ImNvbXBpbGVyL2FwcHMvcGxheWdyb3VuZCIsImluc3BlY3RvclVybCI6Imh0dHBzOi8vdmVyY2VsLmNvbS9mYm9wZW5zb3VyY2UvcmVhY3QtY29tcGlsZXItcGxheWdyb3VuZC9EbWkxZjRhZGc3OERXeHNOS1hUQUhRcFpMM1cyIiwicHJldmlld1VybCI6InJlYWN0LWNvbXBpbGVyLXBsYXlncm91bmQtZ2l0LWZvcmstamFja3BvcGUtMGRiNTYwLWZib3BlbnNvdXJjZS52ZXJjZWwuYXBwIiwibmV4dENvbW1pdFN0YXR1cyI6IkRFUExPWUVEIiwibGl2ZUZlZWRiYWNrIjp7InJlc29sdmVkIjowLCJ1bnJlc29sdmVkIjowLCJ0b3RhbCI6MCwibGluayI6InJlYWN0LWNvbXBpbGVyLXBsYXlncm91bmQtZ2l0LWZvcmstamFja3BvcGUtMGRiNTYwLWZib3BlbnNvdXJjZS52ZXJjZWwuYXBwIn19XX0=\n**The latest updates on your projects**. Learn more about [Vercel for Git â†—ï¸Ž](https://vercel.link/github-learn-more)\n\n| Name | Status | Preview | Comments | Updated (UTC) |\n| :--- | :----- | :------ | :------- | :------ |\n| **react-compiler-playground** | âœ… Ready ([Inspect](https://vercel.com/fbopensource/react-compiler-playground/Dmi1f4adg78DWxsNKXTAHQpZL3W2)) | [Visit Preview](https://vercel.live/open-feedback/react-compiler-playground-git-fork-jackpope-0db560-fbopensource.vercel.app?via=pr-comment-visit-preview-link&passThrough=1) | ðŸ’¬ [**Add feedback**](https://vercel.live/open-feedback/react-compiler-playground-git-fork-jackpope-0db560-fbopensource.vercel.app?via=pr-comment-feedback-link) | Oct 15, 2024 6:11pm |\n\n",
						"author": "vercel[bot]",
						"createdAt": "2024-10-15T18:07:38Z"
					},
					{
						"id": 2414695234,
						"body": "\n<!--\n  0 failure: \n  0 warning: \n  \n  1 markdown notices\n  DangerID: danger-id-stable;\n-->\n\n\n\n\nComparing: 838258144652ab2ef0cbe54d03e9bdd454348d48...e7719f59f556e154c9f42b4eb32fb5b427612cae\n\n## Critical size changes\n\nIncludes critical production bundles, as well as any change greater than 2%:\n\n\n  | Name | +/- | Base | Current | +/- gzip | Base gzip | Current gzip |\n  | ---- | --- | ---- | ------- | -------- | --------- | ------------ |\n| [oss-stable/react-dom/cjs/react-dom.production.js](https://react-builds.vercel.app/commits/e7719f59f556e154c9f42b4eb32fb5b427612cae/files/oss-stable/react-dom/cjs/react-dom.production.js?compare=838258144652ab2ef0cbe54d03e9bdd454348d48) | **=** | 6.68 kB | 6.68 kB | = | 1.83 kB | 1.82 kB\n| [oss-stable/react-dom/cjs/react-dom-client.production.js](https://react-builds.vercel.app/commits/e7719f59f556e154c9f42b4eb32fb5b427612cae/files/oss-stable/react-dom/cjs/react-dom-client.production.js?compare=838258144652ab2ef0cbe54d03e9bdd454348d48) | **+0.04%** | 506.33 kB | 506.53 kB | +0.11% | 90.58 kB | 90.68 kB\n| [oss-experimental/react-dom/cjs/react-dom.production.js](https://react-builds.vercel.app/commits/e7719f59f556e154c9f42b4eb32fb5b427612cae/files/oss-experimental/react-dom/cjs/react-dom.production.js?compare=838258144652ab2ef0cbe54d03e9bdd454348d48) | **=** | 6.69 kB | 6.69 kB | = | 1.83 kB | 1.83 kB\n| [oss-experimental/react-dom/cjs/react-dom-client.production.js](https://react-builds.vercel.app/commits/e7719f59f556e154c9f42b4eb32fb5b427612cae/files/oss-experimental/react-dom/cjs/react-dom-client.production.js?compare=838258144652ab2ef0cbe54d03e9bdd454348d48) | **+0.04%** | 511.26 kB | 511.47 kB | +0.12% | 91.30 kB | 91.40 kB\n| [facebook-www/ReactDOM-prod.classic.js](https://react-builds.vercel.app/commits/e7719f59f556e154c9f42b4eb32fb5b427612cae/files/facebook-www/ReactDOM-prod.classic.js?compare=838258144652ab2ef0cbe54d03e9bdd454348d48) | **+0.09%** | 603.42 kB | 603.93 kB | +0.15% | 106.73 kB | 106.89 kB\n| [facebook-www/ReactDOM-prod.modern.js](https://react-builds.vercel.app/commits/e7719f59f556e154c9f42b4eb32fb5b427612cae/files/facebook-www/ReactDOM-prod.modern.js?compare=838258144652ab2ef0cbe54d03e9bdd454348d48) | **+0.09%** | 579.61 kB | 580.15 kB | +0.15% | 102.82 kB | 102.97 kB\n\n## Significant size changes\n\nIncludes any change greater than 0.2%:\n\n(No significant changes)\n\n<p align=\"right\">\n  Generated by :no_entry_sign: <a href=\"https://danger.systems/js\">dangerJS</a> against 1f0d3e60bd8d8768b9020f18779c3a1d9a0d17de\n</p>\n",
						"author": "react-sizebot",
						"createdAt": "2024-10-15T18:11:39Z"
					}
				],
				"htmlUrl": "https://github.com/facebook/react/pull/31268"
			}
		},
		{
			"sha": "838258144652ab2ef0cbe54d03e9bdd454348d48",
			"message": "[ESLint] Add test for rejected `useId` in async Components (#31208)",
			"user": "eps1lon",
			"timestamp": "2024-10-15T15:17:41Z",
			"author": {
				"name": "Sebastian \"Sebbie\" Silbermann",
				"email": "sebastian.silbermann@vercel.com",
				"username": "eps1lon"
			},
			"files": {
				"added": [],
				"modified": [
					"packages/eslint-plugin-react-hooks/__tests__/ESLintRulesOfHooks-test.js"
				],
				"removed": []
			},
			"diff": "diff --git a/packages/eslint-plugin-react-hooks/__tests__/ESLintRulesOfHooks-test.js b/packages/eslint-plugin-react-hooks/__tests__/ESLintRulesOfHooks-test.js\nindex a98d2b76961..a1e4c49e155 100644\n--- a/packages/eslint-plugin-react-hooks/__tests__/ESLintRulesOfHooks-test.js\n+++ b/packages/eslint-plugin-react-hooks/__tests__/ESLintRulesOfHooks-test.js\n@@ -1129,6 +1129,34 @@ const tests = {\n       `,\n       errors: [asyncComponentHookError('useState')],\n     },\n+    {\n+      code: normalizeIndent`\n+        async function Page() {\n+          useId();\n+          React.useId();\n+        }\n+      `,\n+      errors: [\n+        asyncComponentHookError('useId'),\n+        asyncComponentHookError('React.useId'),\n+      ],\n+    },\n+    {\n+      code: normalizeIndent`\n+        async function useAsyncHook() {\n+          useId();\n+        }\n+      `,\n+      errors: [asyncComponentHookError('useId')],\n+    },\n+    {\n+      code: normalizeIndent`\n+        async function notAHook() {\n+          useId();\n+        }\n+      `,\n+      errors: [functionError('useId', 'notAHook')],\n+    },\n     {\n       code: normalizeIndent`\n         Hook.use();\n",
			"diffSize": 1140,
			"diffTruncated": false,
			"filterResult": {
				"included": true
			},
			"associatedPR": {
				"number": 31208,
				"title": "[ESLint] Add test for rejected `useId` in async Components",
				"state": "closed",
				"draft": false,
				"merged": true,
				"branch": "sebbie/async-component-hooks",
				"baseBranch": "main",
				"author": "eps1lon",
				"body": "## Summary\r\n\r\nJust added tests to make it clear `useId` being disallowed in async Components is intentional.\r\n\r\n`useId` is allowed in Server Components. However, it doesn't work after `await` so we shouldn't allow it in `async` functions. We'd also disallow it if it's wrapped in a custom hook because we can't know whether the hook is stateful.\r\n\r\n`useId` does work in shared components. Shared components cannot be async.\r\n",
				"labels": ["CLA Signed", "React Core Team"],
				"requestedReviewers": ["poteto", "acdlite"],
				"reviews": [
					{
						"id": 2369723740,
						"state": "APPROVED",
						"author": "sebmarkbage"
					}
				],
				"comments": [
					{
						"id": 2408947018,
						"body": "[vc]: #xcS2lAUcYUwKOxMqW7Y9b5Z0SUCQw634lnU26TKL4Xs=:eyJpc01vbm9yZXBvIjp0cnVlLCJ0eXBlIjoiZ2l0aHViIiwicHJvamVjdHMiOlt7Im5hbWUiOiJyZWFjdC1jb21waWxlci1wbGF5Z3JvdW5kIiwiaW5zcGVjdG9yVXJsIjoiaHR0cHM6Ly92ZXJjZWwuY29tL2Zib3BlbnNvdXJjZS9yZWFjdC1jb21waWxlci1wbGF5Z3JvdW5kL0NOa0F0aHV0SmFhWE04cVNpTjlvODdYRXBGaksiLCJwcmV2aWV3VXJsIjoicmVhY3QtY29tcGlsZXItcGxheWdyb3VuZC1naXQtZm9yay1lcHMxbG9uLTIxY2Y2Ni1mYm9wZW5zb3VyY2UudmVyY2VsLmFwcCIsIm5leHRDb21taXRTdGF0dXMiOiJERVBMT1lFRCIsImxpdmVGZWVkYmFjayI6eyJyZXNvbHZlZCI6MCwidW5yZXNvbHZlZCI6MCwidG90YWwiOjAsImxpbmsiOiJyZWFjdC1jb21waWxlci1wbGF5Z3JvdW5kLWdpdC1mb3JrLWVwczFsb24tMjFjZjY2LWZib3BlbnNvdXJjZS52ZXJjZWwuYXBwIn0sInJvb3REaXJlY3RvcnkiOiJjb21waWxlci9hcHBzL3BsYXlncm91bmQifV19\n**The latest updates on your projects**. Learn more about [Vercel for Git â†—ï¸Ž](https://vercel.link/github-learn-more)\n\n| Name | Status | Preview | Comments | Updated (UTC) |\n| :--- | :----- | :------ | :------- | :------ |\n| **react-compiler-playground** | âœ… Ready ([Inspect](https://vercel.com/fbopensource/react-compiler-playground/CNkAthutJaaXM8qSiN9o87XEpFjK)) | [Visit Preview](https://vercel.live/open-feedback/react-compiler-playground-git-fork-eps1lon-21cf66-fbopensource.vercel.app?via=pr-comment-visit-preview-link&passThrough=1) | ðŸ’¬ [**Add feedback**](https://vercel.live/open-feedback/react-compiler-playground-git-fork-eps1lon-21cf66-fbopensource.vercel.app?via=pr-comment-feedback-link) | Oct 15, 2024 1:24pm |\n\n",
						"author": "vercel[bot]",
						"createdAt": "2024-10-13T11:49:41Z"
					},
					{
						"id": 2408947972,
						"body": "\n<!--\n  0 failure: \n  0 warning: \n  \n  1 markdown notices\n  DangerID: danger-id-stable;\n-->\n\n\n\n\nComparing: c7c68ef842639f8535942b6247ef758221d289fb...e991083fb20a40d95a58cdaffe1b20a1e40fc1a2\n\n## Critical size changes\n\nIncludes critical production bundles, as well as any change greater than 2%:\n\n\n  | Name | +/- | Base | Current | +/- gzip | Base gzip | Current gzip |\n  | ---- | --- | ---- | ------- | -------- | --------- | ------------ |\n| [oss-stable/react-dom/cjs/react-dom.production.js](https://react-builds.vercel.app/commits/e991083fb20a40d95a58cdaffe1b20a1e40fc1a2/files/oss-stable/react-dom/cjs/react-dom.production.js?compare=c7c68ef842639f8535942b6247ef758221d289fb) | **=** | 6.68 kB | 6.68 kB | = | 1.82 kB | 1.82 kB\n| [oss-stable/react-dom/cjs/react-dom-client.production.js](https://react-builds.vercel.app/commits/e991083fb20a40d95a58cdaffe1b20a1e40fc1a2/files/oss-stable/react-dom/cjs/react-dom-client.production.js?compare=c7c68ef842639f8535942b6247ef758221d289fb) | **=** | 506.33 kB | 506.33 kB | = | 90.58 kB | 90.58 kB\n| [oss-experimental/react-dom/cjs/react-dom.production.js](https://react-builds.vercel.app/commits/e991083fb20a40d95a58cdaffe1b20a1e40fc1a2/files/oss-experimental/react-dom/cjs/react-dom.production.js?compare=c7c68ef842639f8535942b6247ef758221d289fb) | **=** | 6.69 kB | 6.69 kB | = | 1.83 kB | 1.83 kB\n| [oss-experimental/react-dom/cjs/react-dom-client.production.js](https://react-builds.vercel.app/commits/e991083fb20a40d95a58cdaffe1b20a1e40fc1a2/files/oss-experimental/react-dom/cjs/react-dom-client.production.js?compare=c7c68ef842639f8535942b6247ef758221d289fb) | **=** | 511.26 kB | 511.26 kB | = | 91.30 kB | 91.30 kB\n| [facebook-www/ReactDOM-prod.classic.js](https://react-builds.vercel.app/commits/e991083fb20a40d95a58cdaffe1b20a1e40fc1a2/files/facebook-www/ReactDOM-prod.classic.js?compare=c7c68ef842639f8535942b6247ef758221d289fb) | **=** | 603.42 kB | 603.42 kB | = | 106.73 kB | 106.73 kB\n| [facebook-www/ReactDOM-prod.modern.js](https://react-builds.vercel.app/commits/e991083fb20a40d95a58cdaffe1b20a1e40fc1a2/files/facebook-www/ReactDOM-prod.modern.js?compare=c7c68ef842639f8535942b6247ef758221d289fb) | **=** | 579.61 kB | 579.61 kB | = | 102.82 kB | 102.82 kB\n\n## Significant size changes\n\nIncludes any change greater than 0.2%:\n\n(No significant changes)\n\n<p align=\"right\">\n  Generated by :no_entry_sign: <a href=\"https://danger.systems/js\">dangerJS</a> against 6a590b63d8fb062276c7d59dba766e705279d08a\n</p>\n",
						"author": "react-sizebot",
						"createdAt": "2024-10-13T11:52:59Z"
					},
					{
						"id": 2776825202,
						"body": "Would be good to add these things to the docs too when we land them https://github.com/reactjs/react.dev/pull/7715",
						"author": "rickhanlonii",
						"createdAt": "2025-04-03T20:17:09Z"
					}
				],
				"htmlUrl": "https://github.com/facebook/react/pull/31208"
			}
		},
		{
			"sha": "c7c68ef842639f8535942b6247ef758221d289fb",
			"message": "React DevTools 6.0.0 -> 6.0.1 (#31263)\n\nChanges in this release:\r\n\r\n* Fix React Compiler badging ([poteto](https://github.com/poteto) in\r\n[#31196](https://github.com/facebook/react/pull/31196))\r\n* fix[react-devtools]: fixed timeline profiler tests\r\n([hoxyq](https://github.com/hoxyq) in\r\n[#31261](https://github.com/facebook/react/pull/31261))\r\n* fix[react-devtools]: record timeline data only when supported\r\n([hoxyq](https://github.com/hoxyq) in\r\n[#31154](https://github.com/facebook/react/pull/31154))\r\n* refactor[react-devtools]: flatten reload and profile config\r\n([hoxyq](https://github.com/hoxyq) in\r\n[#31132](https://github.com/facebook/react/pull/31132))\r\n* fix[react-devtools]: remove all listeners when Agent is shutdown\r\n([hoxyq](https://github.com/hoxyq) in\r\n[#31151](https://github.com/facebook/react/pull/31151))\r\n* fix[react-devtools]: removed redundant startProfiling call\r\n([hoxyq](https://github.com/hoxyq) in\r\n[#31131](https://github.com/facebook/react/pull/31131))\r\n* refactor[react-devtools/fiber/renderer]: optimize durations resolution\r\n([hoxyq](https://github.com/hoxyq) in\r\n[#31118](https://github.com/facebook/react/pull/31118))\r\n* fix[react-devtools]: update profiling status before receiving response\r\nfrom backend ([hoxyq](https://github.com/hoxyq) in\r\n[#31117](https://github.com/facebook/react/pull/31117))\r\n* fix[react-devtools]: wrap key string in preformatted text html element\r\n([hoxyq](https://github.com/hoxyq) in\r\n[#31153](https://github.com/facebook/react/pull/31153))\r\n* chore[react-devtools]: drop legacy context tests\r\n([hoxyq](https://github.com/hoxyq) in\r\n[#31059](https://github.com/facebook/react/pull/31059))\r\n* chore[react-devtools]: add legacy mode error message to the ignore\r\nlist for tests ([hoxyq](https://github.com/hoxyq) in\r\n[#31060](https://github.com/facebook/react/pull/31060))\r\n* fix[react-devtools]: request hook initialization inside http server\r\nresponse ([hoxyq](https://github.com/hoxyq) in\r\n[#31102](https://github.com/facebook/react/pull/31102))\r\n* [Flight] Serialize Server Components Props in DEV\r\n([sebmarkbage](https://github.com/sebmarkbage) in\r\n[#31105](https://github.com/facebook/react/pull/31105))\r\n* Add: reload to profile for Fusebox\r\n([EdmondChuiHW](https://github.com/EdmondChuiHW) in\r\n[#31021](https://github.com/facebook/react/pull/31021))\r\n* refactor: allow custom impl of backend realod-to-profile support check\r\n([EdmondChuiHW](https://github.com/EdmondChuiHW) in\r\n[#31048](https://github.com/facebook/react/pull/31048))\r\n* fix: use public instance in Fiber renderer and expose it from\r\ngetInspectorDataForViewAtPoint ([hoxyq](https://github.com/hoxyq) in\r\n[#31068](https://github.com/facebook/react/pull/31068))",
			"user": "hoxyq",
			"timestamp": "2024-10-15T13:15:26Z",
			"author": {
				"name": "Ruslan Lesiutin",
				"email": "rdlesyutin@gmail.com",
				"username": "hoxyq"
			},
			"files": {
				"added": [],
				"modified": [
					"packages/react-devtools-core/package.json",
					"packages/react-devtools-extensions/chrome/manifest.json",
					"packages/react-devtools-extensions/edge/manifest.json",
					"packages/react-devtools-extensions/firefox/manifest.json",
					"packages/react-devtools-inline/package.json",
					"packages/react-devtools-timeline/package.json",
					"packages/react-devtools/CHANGELOG.md",
					"packages/react-devtools/package.json"
				],
				"removed": []
			},
			"diff": "diff --git a/packages/react-devtools-core/package.json b/packages/react-devtools-core/package.json\nindex 23167fa3778..c2d3b0e58af 100644\n--- a/packages/react-devtools-core/package.json\n+++ b/packages/react-devtools-core/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"react-devtools-core\",\n-  \"version\": \"6.0.0\",\n+  \"version\": \"6.0.1\",\n   \"description\": \"Use react-devtools outside of the browser\",\n   \"license\": \"MIT\",\n   \"main\": \"./dist/backend.js\",\ndiff --git a/packages/react-devtools-extensions/chrome/manifest.json b/packages/react-devtools-extensions/chrome/manifest.json\nindex f0209aaa73e..7f29a597029 100644\n--- a/packages/react-devtools-extensions/chrome/manifest.json\n+++ b/packages/react-devtools-extensions/chrome/manifest.json\n@@ -2,8 +2,8 @@\n   \"manifest_version\": 3,\n   \"name\": \"React Developer Tools\",\n   \"description\": \"Adds React debugging tools to the Chrome Developer Tools.\",\n-  \"version\": \"6.0.0\",\n-  \"version_name\": \"6.0.0\",\n+  \"version\": \"6.0.1\",\n+  \"version_name\": \"6.0.1\",\n   \"minimum_chrome_version\": \"102\",\n   \"icons\": {\n     \"16\": \"icons/16-production.png\",\ndiff --git a/packages/react-devtools-extensions/edge/manifest.json b/packages/react-devtools-extensions/edge/manifest.json\nindex ca4d56b4453..dcf1448b087 100644\n--- a/packages/react-devtools-extensions/edge/manifest.json\n+++ b/packages/react-devtools-extensions/edge/manifest.json\n@@ -2,8 +2,8 @@\n   \"manifest_version\": 3,\n   \"name\": \"React Developer Tools\",\n   \"description\": \"Adds React debugging tools to the Microsoft Edge Developer Tools.\",\n-  \"version\": \"6.0.0\",\n-  \"version_name\": \"6.0.0\",\n+  \"version\": \"6.0.1\",\n+  \"version_name\": \"6.0.1\",\n   \"minimum_chrome_version\": \"102\",\n   \"icons\": {\n     \"16\": \"icons/16-production.png\",\ndiff --git a/packages/react-devtools-extensions/firefox/manifest.json b/packages/react-devtools-extensions/firefox/manifest.json\nindex 52f89104b4f..98c8079546e 100644\n--- a/packages/react-devtools-extensions/firefox/manifest.json\n+++ b/packages/react-devtools-extensions/firefox/manifest.json\n@@ -2,7 +2,7 @@\n   \"manifest_version\": 3,\n   \"name\": \"React Developer Tools\",\n   \"description\": \"Adds React debugging tools to the Firefox Developer Tools.\",\n-  \"version\": \"6.0.0\",\n+  \"version\": \"6.0.1\",\n   \"browser_specific_settings\": {\n     \"gecko\": {\n       \"id\": \"@react-devtools\",\ndiff --git a/packages/react-devtools-inline/package.json b/packages/react-devtools-inline/package.json\nindex f0eadaf7e6d..d601f095a7d 100644\n--- a/packages/react-devtools-inline/package.json\n+++ b/packages/react-devtools-inline/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"react-devtools-inline\",\n-  \"version\": \"6.0.0\",\n+  \"version\": \"6.0.1\",\n   \"description\": \"Embed react-devtools within a website\",\n   \"license\": \"MIT\",\n   \"main\": \"./dist/backend.js\",\ndiff --git a/packages/react-devtools-timeline/package.json b/packages/react-devtools-timeline/package.json\nindex 883aad785f6..306b458f386 100644\n--- a/packages/react-devtools-timeline/package.json\n+++ b/packages/react-devtools-timeline/package.json\n@@ -1,7 +1,7 @@\n {\n   \"private\": true,\n   \"name\": \"react-devtools-timeline\",\n-  \"version\": \"6.0.0\",\n+  \"version\": \"6.0.1\",\n   \"license\": \"MIT\",\n   \"dependencies\": {\n     \"@elg/speedscope\": \"1.9.0-a6f84db\",\ndiff --git a/packages/react-devtools/CHANGELOG.md b/packages/react-devtools/CHANGELOG.md\nindex aab41edf090..565eb8869fb 100644\n--- a/packages/react-devtools/CHANGELOG.md\n+++ b/packages/react-devtools/CHANGELOG.md\n@@ -4,6 +4,18 @@\n \n ---\n \n+### 6.0.1\n+October 15, 2024\n+\n+* Fix React Compiler badging ([poteto](https://github.com/poteto) in [#31196](https://github.com/facebook/react/pull/31196))\n+* fix[react-devtools]: record timeline data only when supported ([hoxyq](https://github.com/hoxyq) in [#31154](https://github.com/facebook/react/pull/31154))\n+* fix[react-devtools]: remove all listeners when Agent is shutdown ([hoxyq](https://github.com/hoxyq) in [#31151](https://github.com/facebook/react/pull/31151))\n+* fix[react-devtools]: wrap key string in preformatted text html element ([hoxyq](https://github.com/hoxyq) in [#31153](https://github.com/facebook/react/pull/31153))\n+* fix[react-devtools]: request hook initialization inside http server response ([hoxyq](https://github.com/hoxyq) in [#31102](https://github.com/facebook/react/pull/31102))\n+* refactor: allow custom impl of backend reload-to-profile support check ([EdmondChuiHW](https://github.com/EdmondChuiHW) in [#31048](https://github.com/facebook/react/pull/31048))\n+\n+---\n+\n ### 6.0.0\n September 25, 2024\n \ndiff --git a/packages/react-devtools/package.json b/packages/react-devtools/package.json\nindex 0972fd8c94e..fa7b80d4d0c 100644\n--- a/packages/react-devtools/package.json\n+++ b/packages/react-devtools/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"react-devtools\",\n-  \"version\": \"6.0.0\",\n+  \"version\": \"6.0.1\",\n   \"description\": \"Use react-devtools outside of the browser\",\n   \"license\": \"MIT\",\n   \"repository\": {\n@@ -26,7 +26,7 @@\n     \"electron\": \"^23.1.2\",\n     \"internal-ip\": \"^6.2.0\",\n     \"minimist\": \"^1.2.3\",\n-    \"react-devtools-core\": \"6.0.0\",\n+    \"react-devtools-core\": \"6.0.1\",\n     \"update-notifier\": \"^2.1.0\"\n   }\n }\n",
			"diffSize": 5119,
			"diffTruncated": false,
			"filterResult": {
				"included": true
			},
			"associatedPR": {
				"number": 31263,
				"title": "React DevTools 6.0.0 -> 6.0.1",
				"state": "closed",
				"draft": false,
				"merged": true,
				"branch": "devtools/release/6.0.1",
				"baseBranch": "main",
				"author": "hoxyq",
				"body": "Changes in this release:\r\n\r\n* Fix React Compiler badging ([poteto](https://github.com/poteto) in [#31196](https://github.com/facebook/react/pull/31196))\r\n* fix[react-devtools]: fixed timeline profiler tests ([hoxyq](https://github.com/hoxyq) in [#31261](https://github.com/facebook/react/pull/31261))\r\n* fix[react-devtools]: record timeline data only when supported ([hoxyq](https://github.com/hoxyq) in [#31154](https://github.com/facebook/react/pull/31154))\r\n* refactor[react-devtools]: flatten reload and profile config ([hoxyq](https://github.com/hoxyq) in [#31132](https://github.com/facebook/react/pull/31132))\r\n* fix[react-devtools]: remove all listeners when Agent is shutdown ([hoxyq](https://github.com/hoxyq) in [#31151](https://github.com/facebook/react/pull/31151))\r\n* fix[react-devtools]: removed redundant startProfiling call ([hoxyq](https://github.com/hoxyq) in [#31131](https://github.com/facebook/react/pull/31131))\r\n* refactor[react-devtools/fiber/renderer]: optimize durations resolution ([hoxyq](https://github.com/hoxyq) in [#31118](https://github.com/facebook/react/pull/31118))\r\n* fix[react-devtools]: update profiling status before receiving response from backend ([hoxyq](https://github.com/hoxyq) in [#31117](https://github.com/facebook/react/pull/31117))\r\n* fix[react-devtools]: wrap key string in preformatted text html element ([hoxyq](https://github.com/hoxyq) in [#31153](https://github.com/facebook/react/pull/31153))\r\n* chore[react-devtools]: drop legacy context tests ([hoxyq](https://github.com/hoxyq) in [#31059](https://github.com/facebook/react/pull/31059))\r\n* chore[react-devtools]: add legacy mode error message to the ignore list for tests ([hoxyq](https://github.com/hoxyq) in [#31060](https://github.com/facebook/react/pull/31060))\r\n* fix[react-devtools]: request hook initialization inside http server response ([hoxyq](https://github.com/hoxyq) in [#31102](https://github.com/facebook/react/pull/31102))\r\n* [Flight] Serialize Server Components Props in DEV ([sebmarkbage](https://github.com/sebmarkbage) in [#31105](https://github.com/facebook/react/pull/31105))\r\n* Add: reload to profile for Fusebox ([EdmondChuiHW](https://github.com/EdmondChuiHW) in [#31021](https://github.com/facebook/react/pull/31021))\r\n* refactor: allow custom impl of backend realod-to-profile support check ([EdmondChuiHW](https://github.com/EdmondChuiHW) in [#31048](https://github.com/facebook/react/pull/31048))\r\n* fix: use public instance in Fiber renderer and expose it from getInspectorDataForViewAtPoint ([hoxyq](https://github.com/hoxyq) in [#31068](https://github.com/facebook/react/pull/31068))",
				"labels": ["CLA Signed", "React Core Team"],
				"requestedReviewers": [],
				"reviews": [],
				"comments": [
					{
						"id": 2413888014,
						"body": "[vc]: #JZo3nv90OLfxv8GlHtinnLlydJ4BWAj/raVdL0mZzMY=:eyJpc01vbm9yZXBvIjp0cnVlLCJ0eXBlIjoiZ2l0aHViIiwicHJvamVjdHMiOlt7Im5hbWUiOiJyZWFjdC1jb21waWxlci1wbGF5Z3JvdW5kIiwicm9vdERpcmVjdG9yeSI6ImNvbXBpbGVyL2FwcHMvcGxheWdyb3VuZCIsImluc3BlY3RvclVybCI6Imh0dHBzOi8vdmVyY2VsLmNvbS9mYm9wZW5zb3VyY2UvcmVhY3QtY29tcGlsZXItcGxheWdyb3VuZC9CNFBudG1NN1VjeXVrWHM0S1FLakxaUm90azFNIiwicHJldmlld1VybCI6InJlYWN0LWNvbXBpbGVyLXBsYXlncm91bmQtZ2l0LWZvcmstaG94eXEtZGUtMTQ4NzMzLWZib3BlbnNvdXJjZS52ZXJjZWwuYXBwIiwibmV4dENvbW1pdFN0YXR1cyI6IkRFUExPWUVEIiwibGl2ZUZlZWRiYWNrIjp7InJlc29sdmVkIjowLCJ1bnJlc29sdmVkIjowLCJ0b3RhbCI6MCwibGluayI6InJlYWN0LWNvbXBpbGVyLXBsYXlncm91bmQtZ2l0LWZvcmstaG94eXEtZGUtMTQ4NzMzLWZib3BlbnNvdXJjZS52ZXJjZWwuYXBwIn19XX0=\n**The latest updates on your projects**. Learn more about [Vercel for Git â†—ï¸Ž](https://vercel.link/github-learn-more)\n\n| Name | Status | Preview | Comments | Updated (UTC) |\n| :--- | :----- | :------ | :------- | :------ |\n| **react-compiler-playground** | âœ… Ready ([Inspect](https://vercel.com/fbopensource/react-compiler-playground/B4PntmM7UcyukXs4KQKjLZRotk1M)) | [Visit Preview](https://vercel.live/open-feedback/react-compiler-playground-git-fork-hoxyq-de-148733-fbopensource.vercel.app?via=pr-comment-visit-preview-link&passThrough=1) | ðŸ’¬ [**Add feedback**](https://vercel.live/open-feedback/react-compiler-playground-git-fork-hoxyq-de-148733-fbopensource.vercel.app?via=pr-comment-feedback-link) | Oct 15, 2024 1:16pm |\n\n",
						"author": "vercel[bot]",
						"createdAt": "2024-10-15T13:15:21Z"
					},
					{
						"id": 2467595619,
						"body": "ðŸ‘‹ \r\n\r\nThis update doesn't appear in Firefox - is that known?\r\n\r\nhttps://addons.mozilla.org/en-US/firefox/addon/react-devtools/\r\n\r\n![image](https://github.com/user-attachments/assets/351a92fb-f278-4d8b-9f03-c445e7dbda0f)\r\n",
						"author": "SimenB",
						"createdAt": "2024-11-11T09:03:15Z"
					},
					{
						"id": 2484309345,
						"body": "> ðŸ‘‹ \n> \n> \n> \n> This update doesn't appear in Firefox - is that known?\n> \n> \n> \n> https://addons.mozilla.org/en-US/firefox/addon/react-devtools/\n> \n> \n> \n> ![image](https://github.com/user-attachments/assets/351a92fb-f278-4d8b-9f03-c445e7dbda0f)\n> \n> \n\nHi @SimenB, thanks for pointing this out. Looks like this release was rejected by Firefox team, because they couldn't reproduce the build. I will be back from leave in December and will get this sorted.",
						"author": "hoxyq",
						"createdAt": "2024-11-18T22:57:29Z"
					},
					{
						"id": 2589529886,
						"body": "hi @hoxyq, on the [Mozilla Addons platform](https://addons.mozilla.org/en-US/firefox/addon/react-devtools) the version of this extension is still 6.0.0",
						"author": "fazo96",
						"createdAt": "2025-01-14T10:20:10Z"
					},
					{
						"id": 2755840560,
						"body": "@hoxyq this is still an issue, unfortunately ",
						"author": "SimenB",
						"createdAt": "2025-03-26T22:01:40Z"
					},
					{
						"id": 2756033613,
						"body": "> @hoxyq this is still an issue, unfortunately \n\nThe release process in Firefox extensions store has been really problematic recently. I am aware of the fact that few last releases are not available for Firefox and been trying to fix this for the past weeks.\n\nThe release of 6.1.1 has been delayed for about 4 weeks, because of the bug on Firefox side, which blocked the review team from uploading a build script error.\n\nUnfortunately, now Firefox is not happy about React DevTools using React from source. This technically violates one of their policies, but doesn't make much sense for an extension such as React DevTools. In order to comply with this policy, we would need to have some decent changes in our build infra. I am currently exploring other potential solutions, will post an update here once I have more clarity.",
						"author": "hoxyq",
						"createdAt": "2025-03-27T00:05:34Z"
					}
				],
				"htmlUrl": "https://github.com/facebook/react/pull/31263"
			}
		},
		{
			"sha": "9806a4b0d4e659863f3f04d32da50f545c7199a8",
			"message": "[DevTools] Fix React Compiler badging (#31196)\n\nIn #31140 we switched over the uMC polyfill to use memo instead of state\r\nsince memo would FastRefresh properly. However this busted devtools'\r\nbadging of compiled components; this PR fixes it.\r\n\r\nTODO: tests\r\nCo-authored-by: Ruslan Lesiutin <rdlesyutin@gmail.com>\r\n\r\n---------\r\n\r\nCo-authored-by: Ruslan Lesiutin <rdlesyutin@gmail.com>",
			"user": "poteto",
			"timestamp": "2024-10-15T11:53:45Z",
			"author": {
				"name": "lauren",
				"email": "poteto@users.noreply.github.com",
				"username": "poteto"
			},
			"files": {
				"added": [],
				"modified": [
					"packages/react-devtools-shared/src/backend/fiber/renderer.js"
				],
				"removed": []
			},
			"diff": "diff --git a/packages/react-devtools-shared/src/backend/fiber/renderer.js b/packages/react-devtools-shared/src/backend/fiber/renderer.js\nindex d582e2a3ced..e1bd7881326 100644\n--- a/packages/react-devtools-shared/src/backend/fiber/renderer.js\n+++ b/packages/react-devtools-shared/src/backend/fiber/renderer.js\n@@ -599,6 +599,8 @@ export function getInternalReactConstants(version: string): {\n       !shouldSkipForgetCheck &&\n       // $FlowFixMe[incompatible-type] fiber.updateQueue is mixed\n       (fiber.updateQueue?.memoCache != null ||\n+        (Array.isArray(fiber.memoizedState?.memoizedState) &&\n+          fiber.memoizedState.memoizedState[0]?.[REACT_MEMO_CACHE_SENTINEL]) ||\n         fiber.memoizedState?.memoizedState?.[REACT_MEMO_CACHE_SENTINEL])\n     ) {\n       const displayNameWithoutForgetWrapper = getDisplayNameForFiber(\n",
			"diffSize": 837,
			"diffTruncated": false,
			"filterResult": {
				"included": true
			},
			"associatedPR": {
				"number": 31196,
				"title": "[DevTools] Fix React Compiler badging",
				"state": "closed",
				"draft": false,
				"merged": true,
				"branch": "pr31196",
				"baseBranch": "main",
				"author": "poteto",
				"body": "\nIn #31140 we switched over the uMC polyfill to use memo instead of state since memo would FastRefresh properly. However this busted devtools' badging of compiled components; this PR fixes it.\n\nTODO: tests\nCo-authored-by: Ruslan Lesiutin <rdlesyutin@gmail.com>\n",
				"labels": ["CLA Signed", "React Core Team"],
				"requestedReviewers": [],
				"reviews": [
					{
						"id": 2364058488,
						"state": "APPROVED",
						"author": "josephsavona"
					},
					{
						"id": 2366473486,
						"state": "COMMENTED",
						"author": "hoxyq"
					},
					{
						"id": 2367096018,
						"state": "COMMENTED",
						"author": "poteto"
					},
					{
						"id": 2367445795,
						"state": "COMMENTED",
						"author": "hoxyq"
					}
				],
				"comments": [
					{
						"id": 2408078497,
						"body": "[vc]: #+s0PUuqqmlIuGU59NI0rCb47cxwgRfJnAIhXvZcS5kM=:eyJpc01vbm9yZXBvIjp0cnVlLCJ0eXBlIjoiZ2l0aHViIiwicHJvamVjdHMiOlt7Im5hbWUiOiJyZWFjdC1jb21waWxlci1wbGF5Z3JvdW5kIiwiaW5zcGVjdG9yVXJsIjoiaHR0cHM6Ly92ZXJjZWwuY29tL2Zib3BlbnNvdXJjZS9yZWFjdC1jb21waWxlci1wbGF5Z3JvdW5kLzlOekNXZVQ1OEtDUnJGNW1EZko1ajJySnl4V3MiLCJwcmV2aWV3VXJsIjoicmVhY3QtY29tcGlsZXItcGxheWdyb3VuZC1naXQtcHIzMTE5Ni1mYm9wZW5zb3VyY2UudmVyY2VsLmFwcCIsIm5leHRDb21taXRTdGF0dXMiOiJERVBMT1lFRCIsImxpdmVGZWVkYmFjayI6eyJyZXNvbHZlZCI6MCwidW5yZXNvbHZlZCI6MCwidG90YWwiOjAsImxpbmsiOiJyZWFjdC1jb21waWxlci1wbGF5Z3JvdW5kLWdpdC1wcjMxMTk2LWZib3BlbnNvdXJjZS52ZXJjZWwuYXBwIn0sInJvb3REaXJlY3RvcnkiOiJjb21waWxlci9hcHBzL3BsYXlncm91bmQifV19\n**The latest updates on your projects**. Learn more about [Vercel for Git â†—ï¸Ž](https://vercel.link/github-learn-more)\n\n| Name | Status | Preview | Comments | Updated (UTC) |\n| :--- | :----- | :------ | :------- | :------ |\n| **react-compiler-playground** | âœ… Ready ([Inspect](https://vercel.com/fbopensource/react-compiler-playground/9NzCWeT58KCRrF5mDfJ5j2rJyxWs)) | [Visit Preview](https://vercel.live/open-feedback/react-compiler-playground-git-pr31196-fbopensource.vercel.app?via=pr-comment-visit-preview-link&passThrough=1) | ðŸ’¬ [**Add feedback**](https://vercel.live/open-feedback/react-compiler-playground-git-pr31196-fbopensource.vercel.app?via=pr-comment-feedback-link) | Oct 15, 2024 11:49am |\n\n",
						"author": "vercel[bot]",
						"createdAt": "2024-10-11T20:26:13Z"
					},
					{
						"id": 2413696176,
						"body": "I am doing new RDT release today, in a few hours, so I need this landed. I've validated that it works with https://github.com/facebook/react/pull/31241 and manually testing it.",
						"author": "hoxyq",
						"createdAt": "2024-10-15T11:49:36Z"
					}
				],
				"htmlUrl": "https://github.com/facebook/react/pull/31196"
			}
		},
		{
			"sha": "ec2bf022450107a77cc2850ec96b9173fc6f40eb",
			"message": "fix[react-devtools]: fixed timeline profiler tests (#31261)\n\nFixes tests against React 18 after\r\nhttps://github.com/facebook/react/pull/31154:\r\n- Set `supportsTimeline` to true for `Store`.\r\n- Execute `store.profilerStore.startProfiling` after `legacyRender`\r\nimport, because this is where `react-dom` is imported and renderer is\r\nregistered. We don't yet propagate `isProfiling` flag to newly\r\nregistered renderers, when profiling already started see:\r\n\r\nhttps://github.com/facebook/react/blob/d5bba18b5d81f234657586865248c5b6849599cd/packages/react-devtools-shared/src/hook.js#L203-L204",
			"user": "hoxyq",
			"timestamp": "2024-10-15T11:46:05Z",
			"author": {
				"name": "Ruslan Lesiutin",
				"email": "rdlesyutin@gmail.com",
				"username": "hoxyq"
			},
			"files": {
				"added": [],
				"modified": [
					"packages/react-devtools-shared/src/__tests__/TimelineProfiler-test.js",
					"packages/react-devtools-shared/src/__tests__/setupTests.js"
				],
				"removed": []
			},
			"diff": "diff --git a/packages/react-devtools-shared/src/__tests__/TimelineProfiler-test.js b/packages/react-devtools-shared/src/__tests__/TimelineProfiler-test.js\nindex b4cc9bbc0ba..e632227ab3a 100644\n--- a/packages/react-devtools-shared/src/__tests__/TimelineProfiler-test.js\n+++ b/packages/react-devtools-shared/src/__tests__/TimelineProfiler-test.js\n@@ -1280,13 +1280,13 @@ describe('Timeline profiler', () => {\n     });\n \n     describe('when profiling', () => {\n-      beforeEach(() => {\n-        utils.act(() => store.profilerStore.startProfiling());\n-      });\n-\n       describe('with legacy render', () => {\n         const {render: legacyRender} = getLegacyRenderImplementation();\n \n+        beforeEach(() => {\n+          utils.act(() => store.profilerStore.startProfiling());\n+        });\n+\n         // @reactVersion <= 18.2\n         // @reactVersion >= 18.0\n         it('should mark sync render without suspends or state updates', () => {\n@@ -1537,6 +1537,10 @@ describe('Timeline profiler', () => {\n \n         const {render: modernRender} = getModernRenderImplementation();\n \n+        beforeEach(() => {\n+          utils.act(() => store.profilerStore.startProfiling());\n+        });\n+\n         it('should mark concurrent render without suspends or state updates', () => {\n           utils.act(() => modernRender(<div />));\n \ndiff --git a/packages/react-devtools-shared/src/__tests__/setupTests.js b/packages/react-devtools-shared/src/__tests__/setupTests.js\nindex 0a821345fcb..50431b230ad 100644\n--- a/packages/react-devtools-shared/src/__tests__/setupTests.js\n+++ b/packages/react-devtools-shared/src/__tests__/setupTests.js\n@@ -256,7 +256,9 @@ beforeEach(() => {\n     },\n   });\n \n-  const store = new Store(((bridge: any): FrontendBridge));\n+  const store = new Store(((bridge: any): FrontendBridge), {\n+    supportsTimeline: true,\n+  });\n \n   const agent = new Agent(((bridge: any): BackendBridge));\n   const hook = global.__REACT_DEVTOOLS_GLOBAL_HOOK__;\n",
			"diffSize": 1960,
			"diffTruncated": false,
			"filterResult": {
				"included": true
			},
			"associatedPR": {
				"number": 31261,
				"title": "fix[react-devtools]: fixed timeline profiler tests",
				"state": "closed",
				"draft": false,
				"merged": true,
				"branch": "react-devtools/fix-timeline-profiler-tests",
				"baseBranch": "main",
				"author": "hoxyq",
				"body": "Fixes tests against React 18 after https://github.com/facebook/react/pull/31154:\r\n- Set `supportsTimeline` to true for `Store`.\r\n- Execute `store.profilerStore.startProfiling` after `legacyRender` import, because this is where `react-dom` is imported and renderer is registered. We don't yet propagate `isProfiling` flag to newly registered renderers, when profiling already started see:\r\nhttps://github.com/facebook/react/blob/d5bba18b5d81f234657586865248c5b6849599cd/packages/react-devtools-shared/src/hook.js#L203-L204",
				"labels": ["CLA Signed", "React Core Team"],
				"requestedReviewers": ["EdmondChuiHW"],
				"reviews": [
					{
						"id": 2368933591,
						"state": "APPROVED",
						"author": "vzaidman"
					}
				],
				"comments": [
					{
						"id": 2413453805,
						"body": "[vc]: #9sZ8LjrgtTTjC91F33+ZvPU2E4rrzMjWICYn3P5wk+U=:eyJpc01vbm9yZXBvIjp0cnVlLCJ0eXBlIjoiZ2l0aHViIiwicHJvamVjdHMiOlt7Im5hbWUiOiJyZWFjdC1jb21waWxlci1wbGF5Z3JvdW5kIiwiaW5zcGVjdG9yVXJsIjoiaHR0cHM6Ly92ZXJjZWwuY29tL2Zib3BlbnNvdXJjZS9yZWFjdC1jb21waWxlci1wbGF5Z3JvdW5kL0VKV3B2N0o2V1VjZVJlVGtSaURXcUt1dzR6NzkiLCJwcmV2aWV3VXJsIjoicmVhY3QtY29tcGlsZXItcGxheWdyb3VuZC1naXQtZm9yay1ob3h5cS1yZS00NTIyN2ItZmJvcGVuc291cmNlLnZlcmNlbC5hcHAiLCJuZXh0Q29tbWl0U3RhdHVzIjoiREVQTE9ZRUQiLCJsaXZlRmVlZGJhY2siOnsicmVzb2x2ZWQiOjAsInVucmVzb2x2ZWQiOjAsInRvdGFsIjowLCJsaW5rIjoicmVhY3QtY29tcGlsZXItcGxheWdyb3VuZC1naXQtZm9yay1ob3h5cS1yZS00NTIyN2ItZmJvcGVuc291cmNlLnZlcmNlbC5hcHAifSwicm9vdERpcmVjdG9yeSI6ImNvbXBpbGVyL2FwcHMvcGxheWdyb3VuZCJ9XX0=\n**The latest updates on your projects**. Learn more about [Vercel for Git â†—ï¸Ž](https://vercel.link/github-learn-more)\n\n| Name | Status | Preview | Comments | Updated (UTC) |\n| :--- | :----- | :------ | :------- | :------ |\n| **react-compiler-playground** | âœ… Ready ([Inspect](https://vercel.com/fbopensource/react-compiler-playground/EJWpv7J6WUceReTkRiDWqKuw4z79)) | [Visit Preview](https://vercel.live/open-feedback/react-compiler-playground-git-fork-hoxyq-re-45227b-fbopensource.vercel.app?via=pr-comment-visit-preview-link&passThrough=1) | ðŸ’¬ [**Add feedback**](https://vercel.live/open-feedback/react-compiler-playground-git-fork-hoxyq-re-45227b-fbopensource.vercel.app?via=pr-comment-feedback-link) | Oct 15, 2024 10:04am |\n\n",
						"author": "vercel[bot]",
						"createdAt": "2024-10-15T10:03:31Z"
					}
				],
				"htmlUrl": "https://github.com/facebook/react/pull/31261"
			}
		}
	]
}
